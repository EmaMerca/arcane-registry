<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcane Registry ‚Äî MTG Card Scanner</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Pro:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #0a0908;
            --bg-card: #1a1816;
            --bg-hover: #252220;
            --gold-bright: #d4a847;
            --gold-dim: #8b7038;
            --gold-glow: rgba(212, 168, 71, 0.3);
            --text-primary: #e8e4dc;
            --text-secondary: #9a9590;
            --text-muted: #5c5855;
            --border-gold: #463a24;
            --success: #4a9c6d;
            --error: #c94c4c;
            --mana-white: #f8f6d8;
            --mana-blue: #0e68ab;
            --mana-black: #150b00;
            --mana-red: #d3202a;
            --mana-green: #00733e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Crimson Pro', Georgia, serif;
            background: var(--bg-deep);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Ornate background pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(212, 168, 71, 0.05) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(212, 168, 71, 0.03) 0%, transparent 50%),
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 100px,
                    rgba(212, 168, 71, 0.01) 100px,
                    rgba(212, 168, 71, 0.01) 101px
                );
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        header {
            text-align: center;
            padding: 3rem 0;
            border-bottom: 1px solid var(--border-gold);
            margin-bottom: 3rem;
            position: relative;
        }

        header::after {
            content: '‚ú¶';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-deep);
            padding: 0 1rem;
            color: var(--gold-dim);
            font-size: 1rem;
        }

        h1 {
            font-family: 'Cinzel', serif;
            font-size: 3rem;
            font-weight: 700;
            color: var(--gold-bright);
            text-shadow: 0 0 40px var(--gold-glow);
            letter-spacing: 0.15em;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--text-secondary);
            font-style: italic;
            font-size: 1.1rem;
        }

        .provider-badge {
            display: inline-block;
            margin-top: 0.75rem;
            padding: 0.25rem 0.75rem;
            background: rgba(212, 168, 71, 0.1);
            border: 1px solid var(--border-gold);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--gold-dim);
            letter-spacing: 0.05em;
        }

        /* Main layout */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Panels */
        .panel {
            background: var(--bg-card);
            border: 1px solid var(--border-gold);
            border-radius: 4px;
            padding: 2rem;
            position: relative;
        }

        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--gold-dim), transparent);
        }

        .panel-title {
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
            color: var(--gold-bright);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .panel-title::before {
            content: '‚óÜ';
            font-size: 0.6rem;
            color: var(--gold-dim);
        }

        /* Upload zone */
        .upload-zone {
            border: 2px dashed var(--border-gold);
            border-radius: 4px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(212, 168, 71, 0.02);
        }

        .upload-zone:hover,
        .upload-zone.dragover {
            border-color: var(--gold-bright);
            background: rgba(212, 168, 71, 0.05);
        }

        .upload-zone.dragover {
            transform: scale(1.01);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.6;
        }

        .upload-text {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .upload-hint {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        #file-input {
            display: none;
        }

        /* Preview */
        .preview-container {
            margin-top: 1.5rem;
            display: none;
        }

        .preview-container.visible {
            display: block;
        }

        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 4px;
            border: 1px solid var(--border-gold);
        }

        /* Buttons */
        .btn {
            font-family: 'Cinzel', serif;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gold-bright), var(--gold-dim));
            color: var(--bg-deep);
            font-weight: 600;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px var(--gold-glow);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--gold-dim);
            color: var(--gold-bright);
        }

        .btn-secondary:hover {
            background: rgba(212, 168, 71, 0.1);
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        /* Manual add section */
        .manual-add {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-gold);
        }

        .search-container {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-deep);
            border: 1px solid var(--border-gold);
            border-radius: 3px;
            color: var(--text-primary);
            font-family: 'Crimson Pro', serif;
            font-size: 1rem;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--gold-bright);
            box-shadow: 0 0 10px var(--gold-glow);
        }

        .search-input::placeholder {
            color: var(--text-muted);
            font-style: italic;
        }

        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border: 1px solid var(--border-gold);
            border-top: none;
            border-radius: 0 0 3px 3px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .suggestions.visible {
            display: block;
        }

        .suggestion-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .suggestion-item:hover {
            background: var(--bg-hover);
        }

        /* Results panel */
        .results-container {
            max-height: 600px;
            overflow-y: auto;
        }

        .card-list {
            list-style: none;
        }

        .card-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid var(--border-gold);
            transition: background 0.2s;
        }

        .card-item:hover {
            background: var(--bg-hover);
        }

        .card-image-thumb {
            width: 60px;
            height: 84px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid var(--border-gold);
        }

        .card-info {
            flex: 1;
        }

        .card-name {
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .card-type {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .card-set {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .card-mana {
            font-family: monospace;
            font-size: 0.9rem;
            color: var(--gold-dim);
        }

        .card-remove {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.5rem;
            font-size: 1.2rem;
            transition: color 0.2s;
        }

        .card-remove:hover {
            color: var(--error);
        }

        /* Rarity indicators */
        .rarity-common { color: #b8b8b8; }
        .rarity-uncommon { color: #7ab6d6; }
        .rarity-rare { color: var(--gold-bright); }
        .rarity-mythic { color: #d35a2a; }

        /* Status messages */
        .status {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: none;
        }

        .status.visible {
            display: block;
        }

        .status.loading {
            background: rgba(212, 168, 71, 0.1);
            border: 1px solid var(--gold-dim);
            color: var(--gold-bright);
        }

        .status.success {
            background: rgba(74, 156, 109, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .status.error {
            background: rgba(201, 76, 76, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
        }

        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--gold-dim);
            border-top-color: var(--gold-bright);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Stats bar */
        .stats-bar {
            display: flex;
            justify-content: space-between;
            padding: 1rem;
            background: rgba(212, 168, 71, 0.05);
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            color: var(--gold-bright);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* Export section */
        .export-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-gold);
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-deep);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-gold);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gold-dim);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-item {
            animation: fadeIn 0.3s ease;
        }

        /* Unvalidated section */
        .unvalidated-section {
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(201, 76, 76, 0.05);
            border: 1px solid rgba(201, 76, 76, 0.3);
            border-radius: 4px;
        }

        .unvalidated-title {
            color: var(--error);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .unvalidated-list {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
            font-size: 0.9rem;
            border-top: 1px solid var(--border-gold);
            margin-top: 3rem;
        }

        footer a {
            color: var(--gold-dim);
            text-decoration: none;
        }

        footer a:hover {
            color: var(--gold-bright);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Arcane Registry</h1>
            <p class="subtitle">Catalog your collection through the lens of divination</p>
            <p class="provider-badge" id="provider-badge"></p>
        </header>

        <main class="main-grid">
            <!-- Left Panel: Upload & Add -->
            <div class="panel">
                <h2 class="panel-title">Capture Cards</h2>
                
                <div class="upload-zone" id="upload-zone">
                    <div class="upload-icon">üì∑</div>
                    <p class="upload-text">Drop your card photo here</p>
                    <p class="upload-hint">Supports multiple cards in one image</p>
                </div>
                <input type="file" id="file-input" accept="image/*" capture="environment">

                <div class="preview-container" id="preview-container">
                    <img id="preview-image" class="preview-image" alt="Card preview">
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" id="scan-btn" disabled>
                        Scan Cards
                    </button>
                    <button class="btn btn-secondary" id="clear-btn" style="display: none;">
                        Clear
                    </button>
                </div>

                <div class="manual-add">
                    <h3 class="panel-title">Manual Entry</h3>
                    <div class="search-container">
                        <input type="text" 
                               class="search-input" 
                               id="card-search" 
                               placeholder="Type a card name to search..."
                               autocomplete="off">
                        <div class="suggestions" id="suggestions"></div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Results -->
            <div class="panel">
                <h2 class="panel-title">Collection Registry</h2>

                <div id="status" class="status"></div>

                <div class="stats-bar" id="stats-bar" style="display: none;">
                    <div class="stat">
                        <div class="stat-value" id="total-cards">0</div>
                        <div class="stat-label">Cards</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="unique-sets">0</div>
                        <div class="stat-label">Sets</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="rare-count">0</div>
                        <div class="stat-label">Rares+</div>
                    </div>
                </div>

                <div class="results-container" id="results-container">
                    <div class="empty-state" id="empty-state">
                        <div class="empty-state-icon">üìú</div>
                        <p>Your registry awaits its first entries</p>
                    </div>
                    <ul class="card-list" id="card-list"></ul>
                </div>

                <div id="unvalidated-section" class="unvalidated-section" style="display: none;">
                    <div class="unvalidated-title">
                        <span>‚ö†Ô∏è</span> Unrecognized Text
                    </div>
                    <p class="unvalidated-list" id="unvalidated-list"></p>
                </div>

                <div class="export-section" id="export-section" style="display: none;">
                    <button class="btn btn-primary" id="export-csv-btn">
                        Export CSV
                    </button>
                    <button class="btn btn-secondary" id="clear-all-btn">
                        Clear All
                    </button>
                </div>
            </div>
        </main>

        <footer>
            <p>Powered by <a href="https://scryfall.com" target="_blank">Scryfall</a> ‚Ä¢ Card data is ¬© Wizards of the Coast</p>
        </footer>
    </div>

    <script>
        // State
        let sessionId = null;
        let validatedCards = [];

        // DOM Elements
        const uploadZone = document.getElementById('upload-zone');
        const fileInput = document.getElementById('file-input');
        const previewContainer = document.getElementById('preview-container');
        const previewImage = document.getElementById('preview-image');
        const scanBtn = document.getElementById('scan-btn');
        const clearBtn = document.getElementById('clear-btn');
        const cardSearch = document.getElementById('card-search');
        const suggestions = document.getElementById('suggestions');
        const status = document.getElementById('status');
        const statsBar = document.getElementById('stats-bar');
        const cardList = document.getElementById('card-list');
        const emptyState = document.getElementById('empty-state');
        const unvalidatedSection = document.getElementById('unvalidated-section');
        const unvalidatedList = document.getElementById('unvalidated-list');
        const exportSection = document.getElementById('export-section');
        const exportCsvBtn = document.getElementById('export-csv-btn');
        const clearAllBtn = document.getElementById('clear-all-btn');

        // Upload Zone Events
        uploadZone.addEventListener('click', () => fileInput.click());
        
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                showStatus('Please select an image file', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                previewContainer.classList.add('visible');
                scanBtn.disabled = false;
                clearBtn.style.display = 'inline-block';
            };
            reader.readAsDataURL(file);
        }

        // Clear preview
        clearBtn.addEventListener('click', () => {
            fileInput.value = '';
            previewContainer.classList.remove('visible');
            scanBtn.disabled = true;
            clearBtn.style.display = 'none';
        });

        // Scan button
        scanBtn.addEventListener('click', async () => {
            const file = fileInput.files[0];
            if (!file) return;

            scanBtn.disabled = true;
            showStatus('<span class="spinner"></span> Analyzing image with AI vision...', 'loading');

            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    sessionId = data.session_id;
                    validatedCards = data.validated_cards;
                    
                    renderCards();
                    
                    if (data.unvalidated_names && data.unvalidated_names.length > 0) {
                        unvalidatedList.textContent = data.unvalidated_names.join(', ');
                        unvalidatedSection.style.display = 'block';
                    } else {
                        unvalidatedSection.style.display = 'none';
                    }

                    const detected = data.raw_names ? data.raw_names.length : 0;
                    if (validatedCards.length > 0) {
                        showStatus(`AI detected ${detected} card(s), validated ${validatedCards.length}!`, 'success');
                    } else if (detected > 0) {
                        showStatus(`AI detected ${detected} card(s) but none could be validated against Scryfall.`, 'error');
                    } else {
                        showStatus('No cards detected. Try a clearer photo or add manually.', 'error');
                    }
                } else {
                    // Check for API key errors
                    if (data.error && data.error.includes('API_KEY')) {
                        showStatus('API key not configured. Check your .env file.', 'error');
                    } else {
                        showStatus(data.error || 'Error processing image', 'error');
                    }
                }
            } catch (err) {
                showStatus('Connection error. Please try again.', 'error');
            }

            scanBtn.disabled = false;
        });

        // Card search with autocomplete
        let searchTimeout;
        cardSearch.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim();

            if (query.length < 2) {
                suggestions.classList.remove('visible');
                return;
            }

            searchTimeout = setTimeout(async () => {
                try {
                    const response = await fetch(`/api/search?q=${encodeURIComponent(query)}`);
                    const data = await response.json();

                    if (data.suggestions && data.suggestions.length > 0) {
                        suggestions.innerHTML = data.suggestions
                            .map(name => `<div class="suggestion-item">${name}</div>`)
                            .join('');
                        suggestions.classList.add('visible');
                    } else {
                        suggestions.classList.remove('visible');
                    }
                } catch (err) {
                    console.error('Search error:', err);
                }
            }, 200);
        });

        // Handle suggestion click
        suggestions.addEventListener('click', async (e) => {
            if (e.target.classList.contains('suggestion-item')) {
                const cardName = e.target.textContent;
                cardSearch.value = '';
                suggestions.classList.remove('visible');
                
                showStatus('<span class="spinner"></span> Adding card...', 'loading');

                try {
                    const response = await fetch('/api/manual-add', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            card_name: cardName,
                            session_id: sessionId
                        })
                    });

                    const data = await response.json();

                    if (response.ok && data.card) {
                        validatedCards.push(data.card);
                        renderCards();
                        showStatus(`Added: ${data.card.name}`, 'success');
                    } else {
                        showStatus(data.error || 'Could not add card', 'error');
                    }
                } catch (err) {
                    showStatus('Connection error', 'error');
                }
            }
        });

        // Hide suggestions when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-container')) {
                suggestions.classList.remove('visible');
            }
        });

        // Render cards list
        function renderCards() {
            if (validatedCards.length === 0) {
                emptyState.style.display = 'block';
                cardList.innerHTML = '';
                statsBar.style.display = 'none';
                exportSection.style.display = 'none';
                return;
            }

            emptyState.style.display = 'none';
            statsBar.style.display = 'flex';
            exportSection.style.display = 'flex';

            // Update stats
            document.getElementById('total-cards').textContent = validatedCards.length;
            const sets = new Set(validatedCards.map(c => c.set_code));
            document.getElementById('unique-sets').textContent = sets.size;
            const rareCount = validatedCards.filter(c => 
                c.rarity === 'rare' || c.rarity === 'mythic'
            ).length;
            document.getElementById('rare-count').textContent = rareCount;

            // Render card list
            cardList.innerHTML = validatedCards.map((card, index) => `
                <li class="card-item">
                    ${card.image_url ? 
                        `<img src="${card.image_url}" class="card-image-thumb" alt="${card.name}">` :
                        '<div class="card-image-thumb" style="background: var(--bg-deep);"></div>'
                    }
                    <div class="card-info">
                        <div class="card-name">${card.name}</div>
                        <div class="card-type">${card.type || ''}</div>
                        <div class="card-set">
                            <span class="rarity-${card.rarity}">${card.rarity || ''}</span>
                            ‚Äî ${card.set || ''}
                        </div>
                    </div>
                    <div class="card-mana">${formatMana(card.mana_cost)}</div>
                    <button class="card-remove" data-index="${index}" title="Remove">√ó</button>
                </li>
            `).join('');

            // Add remove handlers
            cardList.querySelectorAll('.card-remove').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    validatedCards.splice(index, 1);
                    renderCards();
                });
            });
        }

        // Format mana cost for display
        function formatMana(manaCost) {
            if (!manaCost) return '';
            return manaCost.replace(/[{}]/g, '');
        }

        // Export CSV
        exportCsvBtn.addEventListener('click', () => {
            if (!sessionId && validatedCards.length > 0) {
                // Generate local CSV if no session
                const csv = generateLocalCSV();
                downloadCSV(csv, 'magic_cards.csv');
                return;
            }
            
            if (sessionId) {
                window.location.href = `/api/export/${sessionId}`;
            }
        });

        function generateLocalCSV() {
            const headers = ['name', 'set', 'set_code', 'type', 'mana_cost', 'rarity'];
            const rows = validatedCards.map(card => 
                headers.map(h => `"${(card[h] || '').replace(/"/g, '""')}"`).join(',')
            );
            return [headers.join(','), ...rows].join('\n');
        }

        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Clear all
        clearAllBtn.addEventListener('click', () => {
            if (confirm('Clear all cards from the registry?')) {
                validatedCards = [];
                sessionId = null;
                unvalidatedSection.style.display = 'none';
                hideStatus();
                renderCards();
            }
        });

        // Status helpers
        function showStatus(message, type) {
            status.innerHTML = message;
            status.className = `status visible ${type}`;
        }

        function hideStatus() {
            status.className = 'status';
        }

        // Fetch and display VLM provider config
        async function loadConfig() {
            try {
                const response = await fetch('/api/config');
                const config = await response.json();
                const badge = document.getElementById('provider-badge');
                const providerNames = {
                    'openai': 'ü§ñ GPT-4 Vision',
                    'anthropic': 'üß† Claude Vision',
                    'deepseek': 'üîÆ DeepSeek Vision'
                };
                badge.textContent = providerNames[config.vlm_provider] || config.vlm_provider;
            } catch (err) {
                console.error('Failed to load config:', err);
            }
        }

        // Initialize
        loadConfig();
        renderCards();
    </script>
</body>
</html>

